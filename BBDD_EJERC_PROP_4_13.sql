CREATE TABLE PROFESOR(
DNI VARCHAR (9) NOT NULL,
NOMBRE CHAR (20) NOT NULL,
AP1 CHAR (20) NOT NULL,
AP2 CHAR (20) NULL,
CONSTRAINT PK_PROFESOR PRIMARY KEY (DNI)
);

CREATE TABLE CICLOFORM (
CODCICLO VARCHAR (2) NOT NULL,
NOMBRE CHAR (20) NOT NULL,
TIPO CHAR (10) NOT NULL, 
CONSTRAINT PK_CODCICLO PRIMARY KEY (CODCICLO)
);

CREATE TABLE ASIGNATURA (
CODASIG VARCHAR (2) NOT NULL,
NOMBRE CHAR (20) NOT NULL,
NUMHORAS NUMBER (2) NOT NULL,
DNIPROF VARCHAR (9) NOT NULL,
CODCICLO VARCHAR (2) NOT NULL,
CONSTRAINT PK_ASIGNATURA PRIMARY KEY (CODASIG),
CONSTRAINT FK_PROFESOR FOREIGN KEY (DNIPROF) REFERENCES PROFESOR (DNI),
CONSTRAINT FK_CICLOFORM FOREIGN KEY (CODCICLO) REFERENCES CICLOFORM (CODCICLO)
);

CREATE TABLE IDIOMA(
CODIDIOMA VARCHAR (2) NOT NULL,
DESCRIPCION CHAR (20) NOT NULL,
CONSTRAINT PK_IDIOMA PRIMARY KEY (CODIDIOMA)
);

CREATE TABLE ALUMNO(
DNI VARCHAR (9) NOT NULL,
NOMBRE CHAR (20) NOT NULL,
AP1 CHAR (20) NOT NULL,
AP2 CHAR (20) NULL,
DIRECCION CHAR (50) NOT NULL,
EMAIL CHAR (30) NOT NULL,
TELEFONO NUMBER (9) NOT NULL,
CODIDIOMA VARCHAR (2) NOT NULL,
CONSTRAINT PK_ALUMNO PRIMARY KEY (DNI),
CONSTRAINT FK_IDIOMA FOREIGN KEY (CODIDIOMA) REFERENCES IDIOMA (CODIDIOMA)
);

CREATE TABLE MATRICULA(
DNIALUM VARCHAR (9) NOT NULL,
CODASIG VARCHAR (2) NOT NULL,
CONSTRAINT PK_MATRICULA PRIMARY KEY (DNIALUM, CODASIG),
CONSTRAINT FK_ALUMNO FOREIGN KEY (DNIALUM) REFERENCES ALUMNO (DNI),
CONSTRAINT FK_ASIGNATURA FOREIGN KEY (CODASIG) REFERENCES ASIGNATURA (CODASIG)
);

CREATE TABLE IDIOMASPROF(
CODIDIOMA VARCHAR (2) NOT NULL,
DNIPROF VARCHAR (9) NOT NULL,
CONSTRAINT PK_IDIOMASPROF PRIMARY KEY (CODIDIOMA,DNIPROF),
CONSTRAINT FK_IDIOMAS FOREIGN KEY (CODIDIOMA) REFERENCES IDIOMA (CODIDIOMA),
CONSTRAINT FK_PROFESORR FOREIGN KEY (DNIPROF) REFERENCES PROFESOR (DNI)
);

CREATE TABLE DATOS_PERSONALES(
DNI VARCHAR (9) NOT NULL CONSTRAINT PK_DATOS PRIMARY KEY,
NOMBRE CHAR (20) NOT NULL,
AP1 CHAR (20) NOT NULL,
AP2 CHAR (20) NULL
);
ALTER TABLE PROFESOR ADD CONSTRAINT FK_DNI_PROF FOREING KEY(DNI) REFERENCES DATOS_PERSONALES(DNI);


ALTER TABLE PROFESOR DROP (NOMBRE);
ALTER TABLE PROFESOR DROP (AP1);
ALTER TABLE PROFESOR DROP (AP2);

ALTER TABLE ALUMNO DROP (NOMBRE);
ALTER TABLE ALUMNO DROP (AP1);
ALTER TABLE ALUMNO DROP (AP2);
ALTER TABLE ALUMNO DROP (DIRECCION);
ALTER TABLE ALUMNO DROP (TELEFONO);

ALTER TABLE DATOS_PERSONALES ADD TIPO VARCHAR (10) NOT NULL;
ALTER TABLE DATOS_PERSONALES ADD DIRECCION VARCHAR (40) NOT NULL;
ALTER TABLE DATOS_PERSONALES ADD TELEFONO NUMBER (9) NOT NULL;
ALTER TABLE DATOS_PERSONALES ADD CONSTRAINT CK_TIPO CHECK (TIPO IN ('ALUMNO','PROFESOR'));

INSERT INTO DATOS_PERSONALES (DNI,NOMBRE,AP1,AP2,TIPO,DIRECCION,TELEFONO)VALUES('71654896M','MARTA','MARTIN','RODRIGUEZ','ALUMNO','C/Miravilla',983652148);
INSERT INTO DATOS_PERSONALES (DNI,NOMBRE,AP1,AP2,TIPO,DIRECCION,TELEFONO)VALUES('44103779F','JESUS','LOPEZ','ANTON','PROFESOR','C/ Lopez Gomez',654987123);
INSERT INTO DATOS_PERSONALES (DNI,NOMBRE,AP1,AP2,TIPO,DIRECCION,TELEFONO)VALUES('11526987G','PEDRO','DIAZ','HERNANDEZ','ALUMNO','C/Transicion',698741236);
INSERT INTO DATOS_PERSONALES (DNI,NOMBRE,AP1,AP2,TIPO,DIRECCION,TELEFONO)VALUES('89621477A','LUIS','VILA','GOMEZ','PROFESOR','C/Cardenal Torquemada',654710236);
INSERT INTO DATOS_PERSONALES (DNI,NOMBRE,AP1,AP2,TIPO,DIRECCION,TELEFONO)VALUES('45986321N','ANDREA','RIVAS','ALONSO','ALUMNO','C/Salud',622254789);
INSERT INTO DATOS_PERSONALES (DNI,NOMBRE,AP1,AP2,TIPO,DIRECCION,TELEFONO)VALUES('71056984D','MIRIAM','ALONSO','BERODAS','ALUMNO','Paseo Zorrilla',645897123);

ALTER TABLE CICLOFORM ADD CONSTRAINT PK_CODCICLO PRIMARY KEY (CODCICLO);
ALTER TABLE ASIGNATURA ADD CONSTRAINT FK_CICLOFORM FOREIGN KEY (CODCICLO) REFERENCES CICLOFORM(CODCICLO);
ALTER TABLE CICLOFORM ADD CODCICLO VARCHAR (4) NOT NULL;
ALTERTABLE CICLOFORM ADD CODCICLO VARCHAR(4) NOT NULL CONSTRAINT PRIMARY KEY;

INSERT INTO CICLOFORM (CODCICLO,NOMBRE,TIPO) VALUES ('1565','DAM','SUPERIOR');
INSERT INTO CICLOFORM (CODCICLO,NOMBRE,TIPO) VALUES ('2598','SMR','MEDIO');
INSERT INTO CICLOFORM (CODCICLO,NOMBRE,TIPO) VALUES ('1489','ARI','SUPERIOR');

ALTER TABLE PROFESOR ADD CUENTA VARCHAR(30) NOT NULL; 
INSERT INTO PROFESOR (DNI,CUENTA)VALUES('44103779F','ES2002399348396092013170');
INSERT INTO PROFESOR (DNI,CUENTA)VALUES('89621477A','ES8501865417580989668301');

INSERT INTO ALUMNO (DNI,EMAIL,CODIDIOMA)VALUES('71654896M','marta.mr@gmail.com','20');
INSERT INTO ALUMNO (DNI,EMAIL,CODIDIOMA)VALUES('11526987G','pedro.dh@gmail.com','20');
INSERT INTO ALUMNO (DNI,EMAIL,CODIDIOMA)VALUES('45986321N','andrea.ra@gmail.com','20');
INSERT INTO ALUMNO (DNI,EMAIL,CODIDIOMA)VALUES('71056984D','miriam.ab@gmail.com','20');

INSERT INTO IDIOMA (CODIDIOMA,DESCRIPCION)VALUES('20','INGLES');
INSERT INTO IDIOMA (CODIDIOMA,DESCRIPCION)VALUES('30','ESPANOL');

ALTER TABLE ASIGNATURA MODIFY CODCICLO VARCHAR(4);
ALTER TABLE ASIGNATURA MODIFY NUMHORAS VARCHAR(3);
INSERT INTO ASIGNATURA (CODASIG,NOMBRE,NUMHORAS,DNIPROF,CODCICLO)VALUES('1','Empresa','128','44103779F','1565');
INSERT INTO ASIGNATURA (CODASIG,NOMBRE,NUMHORAS,DNIPROF,CODCICLO)VALUES('2','Informatica Industrial','269','44103779F','1565');
INSERT INTO ASIGNATURA (CODASIG,NOMBRE,NUMHORAS,DNIPROF,CODCICLO)VALUES('3','Aplicaciones Web','200','89621477A','2598');
INSERT INTO ASIGNATURA (CODASIG,NOMBRE,NUMHORAS,DNIPROF,CODCICLO)VALUES('4','Bases de datos','170','89621477A','1489');
INSERT INTO ASIGNATURA (CODASIG,NOMBRE,NUMHORAS,DNIPROF,CODCICLO)VALUES('5','Programacion','225','89621477A','2598');

INSERT INTO IDIOMASPROF (CODIDIOMA,DNIPROF)VALUES('30','44103779F');
INSERT INTO IDIOMASPROF (CODIDIOMA,DNIPROF)VALUES('20','89621477A');
INSERT INTO IDIOMASPROF (CODIDIOMA,DNIPROF)VALUES('30','89621477A');

INSERT INTO MATRICULA (DNIALUM,CODASIG)VALUES('71654896M','1');
INSERT INTO MATRICULA (DNIALUM,CODASIG)VALUES('11526987G','2');
INSERT INTO MATRICULA (DNIALUM,CODASIG)VALUES('45986321N','3');
INSERT INTO MATRICULA (DNIALUM,CODASIG)VALUES('71056984D','4');
INSERT INTO MATRICULA (DNIALUM,CODASIG)VALUES('71654896M','5');
INSERT INTO MATRICULA (DNIALUM,CODASIG)VALUES('11526987G','1');


SELECT NOMBRE FROM DATOS_PERSONALES,PROFESOR,IDIOMASPROF,IDIOMA
WHERE TIPO = 'PROFESOR'
AND DESCRIPCION = 'ESPANOL'
AND DATOS_PERSONALES.DNI = PROFESOR.DNI
AND PROFESOR.DNI = IDIOMASPROF.DNIPROF
AND IDIOMASPROF.CODIDIOMA = IDIOMA.CODIDIOMA

SELECT ASIGNATURA.NOMBRE FROM CICLOFORM,ASIGNATURA
WHERE CICLOFORM.NOMBRE = 'DAM'
AND CICLOFORM.CODCICLO = ASIGNATURA.CODCICLO

SELECT DATOS_PERSONALES.NOMBRE, PROFESOR.CUENTA FROM DATOS_PERSONALES, PROFESOR

SELECT * FROM DATOS_PERSONALES, ALUMNO
WHERE DATOS_PERSONALES.DNI = ALUMNO.DNI

SELECT * FROM DATOS_PERSONALES, PROFESOR
WHERE DATOS_PERSONALES.DNI = PROFESOR.DNI

SELECT ALUMNO.EMAIL, DATOS_PERSONALES.NOMBRE FROM DATOS_PERSONALES,ALUMNO
WHERE DATOS_PERSONALES.DNI = ALUMNO.DNI

SELECT ALUMNO.EMAIL, DATOS_PERSONALES.NOMBRE FROM DATOS_PERSONALES,ALUMNO,ASIGNATURA
WHERE DATOS_PERSONALES.DNI = ALUMNO.DNI
AND ASIGNATURA.NOMBRE = 'Empresa'

SELECT CICLOFORM.NOMBRE, DATOS_PERSONALES.NOMBRE FROM DATOS_PERSONALES,CICLOFORM,ASIGNATURA,MATRICULA
WHERE ASIGNATURA.CODCICLO = CICLOFORM.CODCICLO
AND MATRICULA.CODASIG = ASIGNATURA.CODASIG
AND MATRICULA.DNIALUM = DATOS_PERSONALES.DNI

SELECT ASIGNATURA.NOMBRE FROM ASIGNATURA, DATOS_PERSONALES, MATRICULA
WHERE DATOS_PERSONALES.DNI = MATRICULA.DNIALUM
AND MATRICULA.CODASIG = ASIGNATURA.CODASIG

SELECT * FROM DATOS_PERSONALES
WHERE DATOS_PERSONALES.NOMBRE='ANDREA'

UPDATE DATOS_PERSONALES SET DATOS_PERSONALES.AP2 = NULL WHERE DATOS_PERSONALES.NOMBRE='ANDREA'

SELECT * FROM MATRICULA, ASIGNATURA
WHERE MATRICULA.CODASIG = ASIGNATURA.CODASIG
AND ASIGNATURA.NOMBRE = 'Programacion'

DELETE MATRICULA WHERE MATRICULA.CODASIG=5

SELECT * FROM MATRICULA, ASIGNATURA
WHERE MATRICULA.CODASIG = ASIGNATURA.CODASIG
AND ASIGNATURA.NOMBRE = 'Empresa'

DELETE MATRICULA WHERE MATRICULA.CODASIG=1

DELETE ASIGNATURA WHERE ASIGNATURA.CODASIG = 1

SELECT * FROM ASIGNATURA
WHERE ASIGNATURA.NOMBRE = 'Bases de datos'

UPDATE ASIGNATURA SET ASIGNATURA.NOMBRE = 'BBDD' WHERE ASIGNATURA.NOMBRE = 'Bases de datos'

SELECT * FROM ASIGNATURA
WHERE ASIGNATURA.NOMBRE = 'BBDD'

INSERT INTO CICLOFORM (CODCICLO,NOMBRE,TIPO) VALUES ('6365','ELEC','MEDIO');

SELECT DATOS_PERSONALES.DNI FROM DATOS_PERSONALES, PROFESOR, ASIGNATURA
WHERE DATOS_PERSONALES.DNI = ASIGNATURA.DNIPROF
AND ASIGNATURA.NOMBRE = 'Aplicaciones Web'

INSERT INTO ASIGNATURA (CODASIG,NOMBRE,NUMHORAS,DNIPROF,CODCICLO)VALUES('6','CircuitoBajaPotencia','100','89621477A','6365');

INSERT INTO IDIOMA (CODIDIOMA,DESCRIPCION)VALUES('50','ALEMAN');

SELECT * FROM DATOS_PERSONALES
WHERE DATOS_PERSONALES.NOMBRE = 'JESUS'

INSERT INTO IDIOMASPROF (CODIDIOMA,DNIPROF)VALUES('50','44103779F');